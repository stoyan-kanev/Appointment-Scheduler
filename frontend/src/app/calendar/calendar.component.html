<section class="booking-wrapper">
    <div class="form-wrapper">
        <div class="calendar-container">
            <p class="error">
                {{ error }}
            </p>

            <div class="barber-select-wrapper">
                <label for="barberSelect">{{ i18n.t('chooseBarber') }}</label>
                <select
                    id="barberSelect"
                    class="barber-select"
                    [(ngModel)]="selectedBarber"
                    name="barber"
                    (change)="selectBarber(selectedBarber)"
                >
                    <option disabled selected value="">
                        -- {{ i18n.t('chooseBarber') }} --
                    </option>
                    <option *ngFor="let barber of barbers" [value]="barber">
                        {{ barber }}
                    </option>
                </select>
            </div>

            <div class="calendar-header">
                <button mat-icon-button (click)="changeMonth(-1)">
                    <mat-icon>chevron_left</mat-icon>
                </button>
                <h2>{{ currentDate | date: 'MMMM yyyy' }}</h2>
                <button mat-icon-button (click)="changeMonth(1)">
                    <mat-icon>chevron_right</mat-icon>
                </button>
            </div>

            <div class="calendar-grid">
                <div class="day-label" *ngFor="let day of dayNames">{{ day }}</div>
                <div
                    class="day-cell"
                    *ngFor="let day of daysInMonth"
                    [class.today]="isToday(day?.date)"
                    [class.selected]="selectedDay === (day?.date | date:'yyyy-MM-dd')"
                    (click)="selectDay(day)"
                >
                    {{ day?.date?.getDate() }}
                </div>
            </div>

            <div *ngIf="selectedDay">
                <h3>{{ i18n.t('serviceTypes') }}</h3>
                <select
                    id="serviceSelect"
                    class="barber-select"
                    [(ngModel)]="selectedService"
                    name="service"
                    (change)="selectService(selectedService)"
                >
                    <option disabled selected value="">
                        -- {{ i18n.t('chooseService') }} --
                    </option>
                    <option *ngFor="let service of services" [value]="service">
                        {{ i18n.t(service) }}
                    </option>
                </select>
            </div>

            <div class="time-slots" *ngIf="showSlots && selectedDay">
                <h3>{{ i18n.t('availableTimes') }}</h3>
                <div class="time-grid">
                    <button
                        *ngFor="let time of getSelectedDaySlots()"
                        class="time-btn"
                        [disabled]="isSlotReserved(time)"
                        (click)="openReservationPopup(time)"
                    >
                        {{ time }}
                    </button>
                </div>
            </div>
        </div>

        <div class="inline-form" *ngIf="showForm">
            <h2 class="title">{{ i18n.t('reserveNow') }}</h2>
            <div class="selected-slot">
                üìÖ <strong>{{ selectedDay }} {{ i18n.t('at') }} {{ selectedSlot }}</strong>
            </div>

            <form [formGroup]="reservationForm" (ngSubmit)="submitForm()">
                <mat-form-field appearance="fill">
                    <input matInput formControlName="first_name" [placeholder]="i18n.t('firstName')" />
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <input matInput formControlName="last_name" [placeholder]="i18n.t('lastName')" />
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <input matInput formControlName="email" [placeholder]="i18n.t('email2')" />
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <input matInput formControlName="phone" [placeholder]="i18n.t('phone2')" />
                </mat-form-field>

                <div class="form-actions">
                    <button mat-button color="warn" type="button" (click)="showForm = false">
                        ‚ùå {{ i18n.t('cancel') }}
                    </button>
                    <button mat-raised-button color="primary" type="submit" [disabled]="reservationForm.invalid">
                        ‚úÖ {{ i18n.t('reserve') }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>
